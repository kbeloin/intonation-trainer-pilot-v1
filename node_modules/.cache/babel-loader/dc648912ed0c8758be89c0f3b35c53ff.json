{"ast":null,"code":"var _jsxFileName = \"/Users/kylebeloin/Desktop/intonation_trainer/intonation_trainer/src/components/pages/ProductionTask.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport Paper from '@material-ui/core/Paper';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport Container from '@material-ui/core/Container';\nimport { withRouter, NavLink } from 'react-router-dom';\nimport Recorder from './Recorder.js';\nimport Player from './Player.js';\nimport axios from \"axios\";\nimport { Scatter } from 'react-chartjs-2';\nimport { newChart, updateChart } from './SoundChart.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  content: {\n    justifyContent: \"center\",\n    display: \"flex\"\n  },\n  paper: {\n    padding: theme.spacing(2),\n    flexDirection: \"row\",\n    minWidth: '100vw',\n    minHeight: '80vh',\n    display: \"flex-box\",\n    elevation: 3,\n    alignItems: \"center\"\n  },\n  container: {\n    position: 'relative',\n    height: '100%',\n    justifyContent: \"center\"\n  },\n  button: {\n    position: 'absolute',\n    bottom: '0',\n    right: '0'\n  },\n  grid: {\n    height: \"50%\",\n    justifyContent: \"space-evenly\",\n    spacing: \"0\",\n    alignItems: \"flex-end\",\n    direction: \"column\",\n    minHeight: \"100%\"\n  },\n  chart: {\n    justifyContent: \"space-evenly\",\n    spacing: \"0\",\n    alignItems: \"flex-end\",\n    direction: \"column\",\n    minHeight: \"40%\",\n    marginBottom: \"1vh\",\n    minWidth: \"35vw\"\n  }\n}));\n\nconst getCSRF = () => {\n  try {\n    const token = document.cookie.split('; ').find(row => row.startsWith('csrftoken=')).split('=')[1];\n    return token;\n  } catch (e) {\n    console.log(e);\n  }\n};\n\nconst uploadFile = (file, s3Data, url) => {\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"POST\", url);\n  console.log(s3Data);\n  var postData = new FormData();\n  var fields = s3Data.fields;\n  console.log(fields);\n  Object.entries(s3Data).forEach(([key, value]) => xhr.setRequestHeader(key, value));\n  postData.append('file', file);\n\n  xhr.onreadystatechange = function () {\n    if (xhr.readyState === 4) {\n      if (xhr.status === 200 || xhr.status === 204) {\n        var response = JSON.parse(xhr.responseText);\n        console.log(response);\n      } else {\n        alert(\"Could not upload file.\");\n      }\n    }\n  };\n\n  console.log(file);\n  xhr.send(postData);\n};\n\nconst getSignedRequest = file => {\n  var xhr = new XMLHttpRequest();\n  xhr.open(\"GET\", \"/api/sign_s3\");\n  xhr.setRequestHeader(\"X-CSRFToken\", getCSRF());\n\n  xhr.onreadystatechange = function () {\n    if (xhr.readyState === 4) {\n      if (xhr.status === 200) {\n        var response = JSON.parse(xhr.responseText);\n        console.log(response);\n        uploadFile(file, response.data, response.url);\n      } else {\n        alert(\"Could not get signed URL.\");\n      }\n    }\n  };\n\n  xhr.send();\n};\n\nconst ProdTask = props => {\n  _s();\n\n  let [src, setCurrentSrc] = useState();\n  let [staged, setStagedData] = useState();\n  let [processedData, setProcessedData] = useState(null);\n  let [chartA, setChartA] = useState();\n  let [chartB, setChartB] = useState();\n  const classes = useStyles();\n  const responseDataRef = useRef(null);\n  const questionDataRef = useRef(null);\n\n  const handleChange = () => {\n    let audio = staged;\n    console.log(staged);\n    document.getElementById('responseData'); // document.getElementById(\"recorder\").currentSrc\n\n    setCurrentSrc(staged); // console.log(src)\n  };\n\n  const processData = data => {\n    var xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", \"/api/process/\", true);\n    xhr.setRequestHeader(\"X-CSRFToken\", getCSRF()); //Send the proper header information along with the request\n\n    xhr.setRequestHeader(\"Content-Type\", \"application/octet-stream\");\n\n    xhr.onreadystatechange = function () {\n      // Call a function when the state changes.\n      if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {\n        var response = JSON.parse(xhr.responseText);\n        setProcessedData(response);\n      }\n    };\n\n    xhr.send(JSON.stringify(data));\n  }; // useEffect(() => {\n  //     // Update the document title using the browser API\n  //     src === undefined ? console.log(\"None\") : processData(src)},[src]);\n\n\n  useEffect(() => {\n    // Update the document title using the browser AP\n    src === undefined ? console.log(\"None\") : processData(src);\n  }, [src]);\n  useEffect(() => {\n    // Update the document title using the browser API\n    processedData === null ? console.log(null) : updateChart(chartB, processedData);\n  }, [processedData]);\n  useEffect(() => {\n    setChartA(newChart(questionDataRef.current));\n    setChartB(newChart(responseDataRef.current)); // Update the document title using the browser AP\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: classes.content,\n    children: /*#__PURE__*/_jsxDEV(Paper, {\n      className: classes.paper,\n      children: /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        className: classes.grid,\n        children: [/*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: [/*#__PURE__*/_jsxDEV(Paper, {\n            className: classes.chart,\n            children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n              id: \"questionData\",\n              ref: questionDataRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Player, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: [/*#__PURE__*/_jsxDEV(Paper, {\n            className: classes.chart,\n            children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n              id: \"responseData\",\n              ref: responseDataRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 196,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 195,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Recorder, {\n            sets: setStagedData\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"outlined\",\n            onClick: handleChange,\n            children: \"Welcome\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 201,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 185,\n    columnNumber: 9\n  }, this);\n};\n\n_s(ProdTask, \"maouOKm3s0X0LzNYcAWl1rTJTfA=\", false, function () {\n  return [useStyles];\n});\n\n_c = ProdTask;\nexport default _c2 = withRouter(ProdTask);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ProdTask\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/kylebeloin/Desktop/intonation_trainer/intonation_trainer/src/components/pages/ProductionTask.js"],"names":["React","useState","useEffect","useRef","makeStyles","Grid","Paper","Button","Typography","Container","withRouter","NavLink","Recorder","Player","axios","Scatter","newChart","updateChart","useStyles","theme","content","justifyContent","display","paper","padding","spacing","flexDirection","minWidth","minHeight","elevation","alignItems","container","position","height","button","bottom","right","grid","direction","chart","marginBottom","getCSRF","token","document","cookie","split","find","row","startsWith","e","console","log","uploadFile","file","s3Data","url","xhr","XMLHttpRequest","open","postData","FormData","fields","Object","entries","forEach","key","value","setRequestHeader","append","onreadystatechange","readyState","status","response","JSON","parse","responseText","alert","send","getSignedRequest","data","ProdTask","props","src","setCurrentSrc","staged","setStagedData","processedData","setProcessedData","chartA","setChartA","chartB","setChartB","classes","responseDataRef","questionDataRef","handleChange","audio","getElementById","processData","DONE","stringify","undefined","current"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport Paper from '@material-ui/core/Paper';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport Container from '@material-ui/core/Container'\nimport { withRouter, NavLink } from 'react-router-dom';\nimport Recorder from './Recorder.js'\nimport Player from './Player.js';\nimport axios from \"axios\";\nimport { Scatter} from 'react-chartjs-2'\nimport { newChart, updateChart } from './SoundChart.js';\n\nconst useStyles = makeStyles((theme) => ({\n  content: {\n    justifyContent: \"center\",\n    display: \"flex\"\n  },\n    paper: {\n        padding: theme.spacing(2),\n        flexDirection: \"row\",\n        minWidth: '100vw',\n        minHeight: '80vh',\n        display:\"flex-box\",\n        elevation: 3,\n        alignItems:\"center\"\n    },\n    container: {\n        position: 'relative',\n        height: '100%',\n        justifyContent: \"center\"\n    },\n    button: {\n        position: 'absolute',\n        bottom:'0',\n        right: '0'\n    },\n    grid: {\n        height: \"50%\",\n        justifyContent:\"space-evenly\",\n        spacing:\"0\",\n        alignItems:\"flex-end\",\n        direction:\"column\",\n        minHeight:\"100%\"\n    },\n\n    chart: {\n        justifyContent:\"space-evenly\",\n        spacing:\"0\",\n        alignItems:\"flex-end\",\n        direction:\"column\",\n        minHeight:\"40%\",\n        marginBottom: \"1vh\",\n        minWidth:\"35vw\",\n    }\n}));\n\nconst getCSRF = () => {\n    try {\n    const token = document.cookie\n        .split('; ')\n        .find(row => row.startsWith('csrftoken='))\n        .split('=')[1]\n    return token\n    } catch (e) {console.log(e)}\n}\n\nconst uploadFile = (file, s3Data, url) => {\n    var xhr = new XMLHttpRequest();\n    xhr.open(\"POST\",url);\n    console.log(s3Data)\n    var postData = new FormData();\n    var fields = s3Data.fields\n    console.log(fields)\n    Object.entries(s3Data).forEach(([key, value]) => \n    xhr.setRequestHeader(key, value));\n\n    postData.append('file', file);\n  \n    xhr.onreadystatechange = function() {\n      if(xhr.readyState === 4){\n        if(xhr.status === 200 || xhr.status === 204){\n            var response = JSON.parse(xhr.responseText);\n            console.log(response)\n        }\n        else{\n          alert(\"Could not upload file.\");\n        }\n     }\n    };\n    console.log(file)\n    xhr.send(postData);\n  }\n\n\nconst getSignedRequest = (file) => {\n    \n    var xhr = new XMLHttpRequest();\n    xhr.open(\"GET\", \"/api/sign_s3\");\n    xhr.setRequestHeader(\"X-CSRFToken\", getCSRF());\n    xhr.onreadystatechange = function(){\n        if(xhr.readyState === 4){\n        if(xhr.status === 200){\n            var response = JSON.parse(xhr.responseText);\n            console.log(response)\n            uploadFile(file, response.data, response.url);\n        }\n        else{\n            alert(\"Could not get signed URL.\");\n        }\n        }\n    };\n    xhr.send();\n    }\n\n\n\nconst ProdTask = (props) => {\n    let [src, setCurrentSrc] = useState()\n    let [staged, setStagedData] = useState()\n    let [processedData, setProcessedData] = useState(null)\n    let [chartA, setChartA] = useState()\n    let [chartB, setChartB] = useState()\n    const classes = useStyles();\n    const responseDataRef = useRef(null);\n    const questionDataRef = useRef(null);\n    \n    \n\n    const handleChange = () => {\n        let audio = staged\n        console.log(staged)\n        document.getElementById('responseData')\n        // document.getElementById(\"recorder\").currentSrc\n        setCurrentSrc(staged)     // console.log(src)\n    }\n    \n    const processData = (data) => {\n        var xhr = new XMLHttpRequest()\n        \n    \n        xhr.open(\"POST\", \"/api/process/\", true);\n        xhr.setRequestHeader(\"X-CSRFToken\", getCSRF());\n        //Send the proper header information along with the request\n        xhr.setRequestHeader(\"Content-Type\", \"application/octet-stream\");\n    \n        \n        xhr.onreadystatechange = function() { // Call a function when the state changes.\n            if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {\n                var response = JSON.parse(xhr.responseText);\n                \n                setProcessedData(response)\n                \n            }\n        }\n        \n        xhr.send(JSON.stringify(data))\n    \n    }\n    // useEffect(() => {\n    //     // Update the document title using the browser API\n        \n    //     src === undefined ? console.log(\"None\") : processData(src)},[src]);\n    \n    useEffect(() => {\n        // Update the document title using the browser AP\n        src === undefined ? console.log(\"None\") : processData(src)},[src]);\n\n    useEffect(() => {\n            // Update the document title using the browser API\n        \n        processedData === null ? console.log(null) : updateChart(chartB, processedData)\n    },[processedData]);\n\n    useEffect(() => {\n        setChartA(newChart(questionDataRef.current))\n        setChartB(newChart(responseDataRef.current))\n        // Update the document title using the browser AP\n},[]);\n    \n\n    \n    return (\n        <div className={classes.content}>\n            <Paper className={classes.paper}>\n                <Grid container className={classes.grid}>\n                    <Grid item>\n                        <Paper className={classes.chart}>  \n                            <canvas id=\"questionData\" ref={questionDataRef}></canvas>\n                        </Paper>\n                        <Player/>\n                    </Grid>\n                    <Grid item>\n                        <Paper className={classes.chart}>\n                            <canvas id=\"responseData\" ref={responseDataRef}></canvas>\n                        </Paper>\n                        <Recorder sets={setStagedData}/>\n                    </Grid>\n                    <Grid item>\n                        <Button variant=\"outlined\" onClick={handleChange}>Welcome</Button>\n                    </Grid>\n                </Grid>\n            </Paper>\n        </div>\n        );\n    }\nexport default withRouter(ProdTask)\n"]},"metadata":{},"sourceType":"module"}